<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }

        .hero {
            background-color: #4CAF50;
            color: white;
            padding: 50px 20px;
            text-align: center;
        }

        .hero-content h1 {
            font-size: 3em;
            animation: fadeInDown 1s ease;
        }

        .hero-content p {
            font-size: 1.2em;
            animation: fadeIn 2s ease;
        }

        .btn {
            padding: 10px 20px;
            background-color: #FF5722;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            background-color: #E64A19;
        }

        .main-content {
            margin: 20px auto;
            max-width: 900px;
        }

        .stat-card {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 400px;
            text-align: center;
        }

        .close-modal {
            float: right;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="hero">
        <div class="hero-buttons" style="position: absolute; right: 20px; top: 20px;">
            <a href="/logout" class="btn">Logout</a>
        </div>
        <div class="hero-content" style="display: flex; justify-content: center; align-items: center; height: 100%;">
            <div style="text-align: center;">
                <h1 class="animate__animated animate__fadeInDown">Welcome, {{ session['name'] }}</h1>
                <p class="animate__animated animate__fadeIn">View your activity logs and productivity stats below.</p>
            </div>
        </div>
    </div>

    <div class="main-content">
        <section class="stats-overview">
            <div class="stat-card">
                <h3>Total Absence Time</h3>
                <p id="total-absence-time">{{ total_absence_time }} hours</p>
            </div>
            <div class="stat-card">
                <h3>Total Phone Usage Time</h3>
                <p id="total-phone-usage-time">{{ total_phone_usage_time }} minutes</p>
            </div>
            <div class="stat-card">
                <h3>Total Working Hours</h3>
                <p id="total-working-hours">{{ total_working_hours }} hours</p>
            </div>
        </section>

        <section class="log-container">
            <h2>Activity Logs</h2>
            <ul id="log-list">
                {% for log in logs %}
                <li>{{ log.log_time }}: {{ log.event }}</li>
                {% endfor %}
            </ul>
        </section>

        <!-- Updated buttons for start recording, lunch break, and meeting -->
        <button class="btn" id="start-rec-btn">Start Recording</button>
        <button class="btn" id="lunch-btn">Lunch Break</button>
        <button class="btn" id="meeting-btn">Meeting</button>
        <button class="btn" id="stop-rec-btn">Stop Recording</button>

    </div>

    <!-- Modal for Meeting Details -->
    <div id="meeting-modal" class="modal">
        <div class="modal-content animate__animated animate__zoomIn">
            <span class="close-modal" id="close-modal">&times;</span>
            <h2>Meeting Info</h2>
            <form id="meeting-form" method="POST">
                <label for="meeting-with">Meeting With:</label>
                <input type="text" id="meeting-with" name="meeting_with" required>
                <br><br>
                <label for="meeting-desc">Description:</label>
                <textarea id="meeting-desc" name="meeting_desc" required></textarea>
                <br><br>
                <button type="button" id="start-meeting-btn" class="btn">Start Meeting</button>
                <button type="button" id="stop-meeting-btn" class="btn">Stop Meeting</button>
            </form>
        </div>
    </div>

    <!-- Modal for Lunch Confirmation -->
    <div id="lunch-modal" class="modal">
        <div class="modal-content animate__animated animate__zoomIn">
            <span class="close-modal" id="close-lunch-modal">&times;</span>
            <h2>Lunch Break</h2>
            <p>Do you want to pause recording for lunch?</p>
            <button id="confirm-lunch-btn" class="btn">Yes</button>
            <button id="cancel-lunch-btn" class="btn">No</button>
        </div>
    </div>



    <script>
        // Fetching logs
        // function fetchLogs() {
        //     fetch('/get-logs')
        //         .then(response => response.json())
        //         .then(data => {
        //             // Update stats with actual data
        //             document.getElementById('total-absence-time').textContent = data.total_absence_time + ' hours';
        //             document.getElementById('total-phone-usage-time').textContent = data.total_phone_usage_time + ' minutes';
        //             document.getElementById('total-working-hours').textContent = data.total_working_hours + ' hours';

        //             // Populate activity logs
        //             var logListElement = document.getElementById('log-list');
        //             logListElement.innerHTML = ''; // Clear the log list before adding new data
        //             data.logs.forEach(log => {
        //                 var logListItem = document.createElement('li');
        //                 logListItem.textContent = log.log_time + ': ' + log.event;
        //                 logListElement.appendChild(logListItem);
        //             });
        //         })
        //         .catch(error => console.error('Error fetching logs:', error));
        // }

        // Fetch logs on page load
        // document.addEventListener('DOMContentLoaded', fetchLogs);

        // Start recording
        document.getElementById('start-rec-btn').addEventListener('click', function () {
            fetch('/start-recording', {
                method: 'POST'
            })
                .then(response => {
                    if (response.ok) {
                        alert('Recording started successfully!');
                    } else {
                        alert('Error starting recording: ' + response.statusText);
                    }
                });

        });

        const meetingBtn = document.getElementById('meeting-btn');
        const meetingModal = document.getElementById('meeting-modal');
        const closeModal = document.getElementById('close-modal');

        // Show modal when meeting button clicked
        meetingBtn.addEventListener('click', function () {
            meetingModal.style.display = 'flex';
        });

        // Close meeting modal on clicking close
        closeModal.addEventListener('click', function () {
            meetingModal.style.display = 'none';
        });

        // Close meeting modal when clicking outside of modal content
        window.addEventListener('click', function (event) {
            if (event.target === meetingModal) {
                meetingModal.style.display = 'none';
            }
        });

        // Start meeting
        document.getElementById('start-meeting-btn').addEventListener('click', function () {
            const meetingWith = document.getElementById('meeting-with').value;
            const meetingDesc = document.getElementById('meeting-desc').value;

            fetch('/start-meeting', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    meeting_with: meetingWith,
                    meeting_desc: meetingDesc
                })
            })
                .then(response => {
                    if (response.ok) {
                        alert('Meeting scheduled successfully!');
                        meetingModal.style.display = 'none';
                        // Optionally fetch logs again to update the dashboard
                        // fetchLogs();
                    } else {
                        alert('Error scheduling meeting: ' + response.statusText);
                    }
                });
        });

        // Stop meeting
        document.getElementById('stop-meeting-btn').addEventListener('click', function () {
            fetch('/stop-meeting', {
                method: 'POST'
            })
                .then(response => {
                    if (response.ok) {
                        alert('Meeting ended successfully!');
                        // Optionally fetch logs again to update the dashboard
                        // fetchLogs();
                    } else {
                        alert('Error ending meeting: ' + response.statusText);
                    }
                });
        });

        const lunchBtn = document.getElementById('lunch-btn');
        const lunchModal = document.getElementById('lunch-modal');
        const closeLunchModal = document.getElementById('close-lunch-modal');

        // Show lunch confirmation modal when lunch button clicked
        lunchBtn.addEventListener('click', function () {
            lunchModal.style.display = 'flex';
        });

        // Close lunch modal on clicking close
        closeLunchModal.addEventListener('click', function () {
            lunchModal.style.display = 'none';
        });

        // Cancel lunch break
        document.getElementById('cancel-lunch-btn').addEventListener('click', function () {
            lunchModal.style.display = 'none'; // Close modal
        });

        // Confirm lunch break
        document.getElementById('confirm-lunch-btn').addEventListener('click', function () {
            fetch('/take-lunch', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'confirmation=pause'  // Sending confirmation to pause recording
            })
                .then(response => {
                    if (response.ok) {
                        lunchModal.style.display = 'none';
                        alert('Lunch break started. Recording paused.');
                    } else {
                        alert('Error during lunch break: ' + response.statusText);
                    }
                });
        });

        // Resume lunch break
        document.getElementById('resume-lunch-btn').addEventListener('click', function () {
            fetch('/take-lunch', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'confirmation=resume'  // Sending confirmation to resume recording
            })
                .then(response => {
                    if (response.ok) {
                        lunchModal.style.display = 'none';
                        alert('Lunch break ended. Recording resumed.');
                    } else {
                        alert('Error resuming lunch break: ' + response.statusText);
                    }
                });
        });

        // Stop recording (if applicable)
        document.getElementById('stop-rec-btn').addEventListener('click', function () {
            fetch('/stop-recording', {
                method: 'POST'
            })
            .then(response => {
                if (response.ok) {
                    alert('Recording stopped successfully!');
                } else {
                    alert('Error stopping recording: ' + response.statusText);
                }
            });
        });


    </script>
</body>

</html>